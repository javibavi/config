"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[4483],{80918:(e,t,n)=>{n.d(t,{X:()=>j});var s=n(30758),i=n(62411),r=n(49263),l=n(93492),a=n(12032),o=n(56695),c=n(71338),m=n(56116),u=n(48975),d=n(24395),x=n(21053),g=n(49593),p=n(68055),h=n(80687),b=n(86070);const y=({currentUserUri:e,uri:t,name:n,divider:d,onBlock:y})=>{const j=(0,m.W)(),v=!(0,u.n)(),{isBlocked:C,blockUser:f,unblockUser:w}=function(e,t,n,r){const[o,m]=(0,s.useState)(!1),u=(0,i.wA)(),d=(0,x.a)(),b=(0,h.A)(),{enqueueSnackbar:y}=(0,c.d)();return(0,s.useEffect)((()=>{e&&(0,p.zP)(b,{currentUserUri:e,uri:t}).then((e=>{if(d()){if(200!==e.status)throw new Error("Invalid response from socialgraph");m(e.body?.[0]?.is_dismissed||!1)}}))}),[e,t,d,b]),{isBlocked:o,blockUser:()=>{e&&u((0,a.zj)(t,n,r))},unblockUser:async()=>{e&&(await(0,p.kV)(g.n.getInstance(),{currentUserUri:e,uri:t}),y(l.Ru.get("feedback.unblock-user")))}}}(e,t,n,y),S=(0,s.useCallback)((async()=>{j({targetUri:t,intent:C?"unblock":"block",type:"click"}),C?await w():await f()}),[j,t,f,w,C]);if(!e||e===t)return null;const R=C?l.Ru.get("contextmenu.unblock"):l.Ru.get("contextmenu.block");return(0,b.jsx)(o.D,{role:"menuitem",divider:d,disabled:v,onClick:S,leadingIcon:(0,b.jsx)(r.r,{semanticColor:"textSubdued",size:"small"}),children:R})},j=s.memo((function(e){return(0,b.jsx)(d.pZ,{value:"block-user",children:(0,b.jsx)(y,{...e})})}))},34855:(e,t,n)=>{n.d(t,{B:()=>F});var s=n(30758),i=n(62411),r=n(93492),l=n(55669),a=n(80918),o=n(42026),c=n(33650),m=n(56695),u=n(24395),d=n(86070);const x=s.memo((function({onClick:e,divider:t,canEdit:n}){return e&&n?(0,d.jsx)(u.pZ,{value:"edit-profile",children:(0,d.jsx)(m.D,{role:"menuitem",divider:t,onClick:e,leadingIcon:(0,d.jsx)(c.G,{semanticColor:"textSubdued",size:"small"}),children:r.Ru.get("contextmenu.edit-profile")})}):null}));var g=n(27508),p=n(96869),h=n(8950),b=n(56116),y=n(48975),j=n(306),v=n(98962),C=n(82362);const f=()=>{},w=({uri:e,divider:t,onRemoveCallback:n=f})=>{const{spec:l,logger:a}=(0,C.r)(h.F,{data:{uri:e}}),o=(0,b.W)(),c=!(0,y.n)(),u=(0,i.d4)(v.Ht).user,[x,w]=(0,j.Y)(e),S=(0,s.useCallback)((()=>{const t=l.followButtonFactory();o({targetUri:e,intent:x?"unfollow":"follow",type:"click"}),x?(w(!1),a.logInteraction(t.hitUnfollow({itemToBeUnfollowed:e})),n(e)):(w(!0),a.logInteraction(t.hitFollow({itemToBeFollowed:e})))}),[x,a,o,n,w,l,e]);if(u&&u.uri===e)return null;const R=x?r.Ru.get("contextmenu.unfollow"):r.Ru.get("contextmenu.follow");return(0,d.jsx)(m.D,{role:"menuitem",testid:"follow-user-context-menu-item",divider:t,disabled:c,onClick:S,leadingIcon:x?(0,d.jsx)(g.M,{semanticColor:"textBrightAccent",size:"small"}):(0,d.jsx)(p.h,{semanticColor:"textSubdued",size:"small"}),children:R})},S=s.memo((function(e){return(0,d.jsx)(u.pZ,{value:"follow-user",children:(0,d.jsx)(w,{...e})})}));var R=n(97395),k=n(5879),U=n(12032),E=n(90843),N=n(94822),I=n(75788),D=n(33887);function B({userUri:e}){const{currentSession:t}=(0,N.D)(),n=(0,I.d)(),l=(0,i.wA)(),a=(0,s.useCallback)((()=>{const n=(0,D.Bj)(t?.sessionMembers??[],e);n&&l((0,U.A9)(E.EL.REMOVE_PARTICIPANT,void 0,n))}),[t?.sessionMembers,l,e]),o=(0,D.kt)(n,e);return t?.active&&e&&o?(0,d.jsx)(m.D,{role:"menuitem",onClick:a,leadingIcon:(0,d.jsx)(k.f,{semanticColor:"textSubdued",size:"small"}),children:r.Ru.get("web-player.social-connect.kick-users.remove-the-user")}):(0,d.jsx)(d.Fragment,{})}var T=n(68055),O=n(43080),_=n(69611);const F=s.memo((function({uri:e,onEditProfileCallback:t}){const{user:n}=(0,i.d4)(v.Ht),{spec:s}=(0,_.o)(e),{data:c,loading:m}=(0,O.Z)(T.E$,[{uri:e}]);return m?null:c?(0,d.jsx)(u.pZ,{value:"user",children:(0,d.jsxs)(l.W,{children:[(0,d.jsx)(S,{uri:e}),(0,d.jsx)(B,{userUri:e}),(0,d.jsx)(a.X,{uri:c.uri,name:c.name,currentUserUri:n?.uri}),(0,d.jsx)(x,{onClick:t,canEdit:!(e!==n?.uri||c.edit_image_disabled&&c.edit_name_disabled)}),(0,d.jsx)(R.P,{spec:s,uri:e,canReportUser:!c.report_abuse_disabled,currentUserUri:n?.uri}),(0,d.jsx)(o.m,{spec:s,uri:e,displayText:r.Ru.get("contextmenu.share.copy-profile-link")})]})}):null}))},90636:(e,t,n)=>{n.d(t,{w:()=>x,X:()=>d});var s=n(30758),i=n(97500),r=n.n(i),l=n(13505),a=n(92197);const o="main-nowPlayingView-section",c="main-nowPlayingView-sectionHeader",m="main-nowPlayingView-sectionHeaderText";var u=n(86070);const d=({action:e,children:t,className:n,icon:s,tooltipLabel:i})=>(0,u.jsxs)(l.E,{as:"div",variant:"bodyMediumBold",semanticColor:"textBase",className:r()(c,n),children:[s,i?(0,u.jsx)(a.Zp,{label:i,children:(0,u.jsx)("div",{className:m,children:t})}):(0,u.jsx)("div",{className:m,children:t}),e]}),x=(0,s.forwardRef)((({children:e,className:t,style:n,testId:s},i)=>{const l={};return s&&(l["data-testid"]=s),(0,u.jsx)("div",{ref:i,className:r()(o,t),style:n,...l,children:e})}))},4413:(e,t,n)=>{n.d(t,{c:()=>ue});var s=n(30758),i=n(97500),r=n.n(i),l=n(94934),a=n(61e3),o=n(12431),c=n(93492),m=n(12367),u=n(62411),d=n(72574),x=n(55669),g=n(80918),p=n(97395),h=n(36419),b=n(78943),y=n(56695),j=n(71338),v=n(4586),C=n(98929),f=n(46581),w=n(55037),S=n(58897);var R=n(50107),k=n(86070);const U=({commentUri:e,entityUri:t,divider:n})=>{const i=(0,u.wA)(),{enqueueSnackbar:r}=(0,j.d)(),l=((e,t)=>{const n=(0,S.n)(),s=(0,C.jE)(),{mutate:i}=(0,f.n)({mutationFn:()=>n.deleteComment(e),onSettled:()=>{s.invalidateQueries({queryKey:w.K.byEntity(t)})}});return i})(e,t),{logDeleteComment:a}=(0,v._)(),o=(0,s.useCallback)((()=>{i(R.FR.actions.open({onConfirm:()=>{a(e),l(),r(c.Ru.get("web-player.user-comments.delete-comment-dialog.success"))}}))}),[e,l,i,r,a]);return(0,k.jsx)(y.D,{role:"menuitem",divider:n,onClick:o,leadingIcon:(0,k.jsx)(b.P,{semanticColor:"textSubdued",size:"small"}),children:c.Ru.get("contextmenu.delete")})};var E=n(98962),N=n(24395),I=n(69611),D=n(78172);const B=s.memo((function({commentUri:e,entityUri:t,author:n}){const{user:i}=(0,u.d4)(E.Ht),{spec:r}=(0,I.o)(e),{uri:l,name:a,type:o}=n,{refreshComments:c}=(0,h.$)(t),m=(0,s.useCallback)((()=>setTimeout((()=>c()),500)),[c]);if(!i?.uri)return null;const b=(0,d.B2u)(i.uri,l);return l?(0,k.jsx)(N.pZ,{value:"comment",children:(0,k.jsx)(x.W,{children:b?(0,k.jsx)(U,{commentUri:e,entityUri:t}):(0,k.jsxs)(k.Fragment,{children:[o===D.c.USER&&(0,k.jsx)(g.X,{uri:l,name:a??"",currentUserUri:i?.uri,onBlock:m}),(0,k.jsx)(p.P,{spec:r,uri:e})]})})}):null}));var T=n(55117),O=n(75189);const _="UJjZEfOFY27iPvvtHVqP",F="iG_rhOCCEbMofMMzLToY",A="m5OZXQj7TeGCKUuoKUQJ",L="fDtd4a5aWLa0rMQxCmn4",P="BcqJ5242UcnkbIJ3PabB",z="LWpR7exIYyWovDOCykgZ",M="UHUP_LyhKA2NR6aaVysB",H="U8WSYONc9O5jC7ci4mHs",K="OwozHdpYAKIM0oPuDJrd",W="ixHYU0G9pFyR9yXX2PEs",Y="E0bOD7hg_tyr9WBjrmHq",q="PRJpBjbhDySrUCuVu2Jh",V=({author:e})=>(0,k.jsx)(T.b,{className:L,images:e.images,shape:e.type===D.c.USER?T.u.CIRCLE:T.u.ROUNDED_CORNERS,size:O.Qe.SIZE_32,iconSize:"small",type:e.type,title:e.name});var Z=n(94154),X=n(84594);const Q=({creationDate:e,isPendingReview:t})=>{if(!e.isoString)return null;const n=e.isoString&&Date.now()-new Date(e.isoString).getTime()<6e4?c.Ru.get("web-player.user-comments.just-now"):c.Ru.formatRelativeDate(new Date(e.isoString),{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"},new Date,1/0),s=t?(0,X.v)("In review"):void 0;return(0,k.jsxs)(Z.j,{hasTextSeparator:!0,children:[n,s]})};var G=n(87662),J=n(55158),$=n(39550),ee=n(34855),te=n(5119);const ne=({commentUri:e,author:t})=>{const n=t.type===D.c.USER?(0,k.jsx)(ee.B,{uri:t.uri}):(0,k.jsx)($.H,{uri:t.uri}),{logNavigateToCommentAuthor:i}=(0,v._)(),r=(0,s.useCallback)((()=>{i(e,t.uri)}),[t.uri,e,i]);return(0,k.jsxs)("span",{className:P,children:[t.type===D.c.SHOW?(0,k.jsx)(G.I,{size:"small",semanticColor:"textSubdued",className:z}):null,(0,k.jsx)(J.d,{lineClamp:1,as:"div",dir:"auto",variant:"bodySmallBold",className:P,children:(0,k.jsx)(m.h,{menu:n,children:(0,k.jsx)(te.N,{to:t.uri,onClick:r,children:t.name})})})]})};var se=n(79202),ie=n(585);const re=({imagesReacted:e})=>(0,k.jsx)("div",{className:H,children:(0,k.jsx)(T.b,{className:K,images:e,shape:T.u.ROUNDED_CORNERS,size:O.Qe.SIZE_24,iconSize:"small",type:D.c.SHOW,title:""})}),le=({comment:e,entityUri:t,imagesReacted:n})=>{const{logCommentMenuOpened:i}=(0,v._)(),r=(0,s.useCallback)((()=>{i(e.uri)}),[e.uri,i]);return(0,k.jsxs)("div",{className:M,children:[(0,k.jsx)("div",{className:F,children:(0,k.jsx)(ie.b,{menu:(0,k.jsx)(B,{commentUri:e.uri,entityUri:t,author:e.author}),onShow:r,children:(0,k.jsx)(se.e,{size:"small",condensedAll:!0})})}),n&&n.length>0&&(0,k.jsx)(re,{imagesReacted:n})]})},ae=({commentUri:e,numReplies:t,images:n,onClick:i})=>{const{logSeeRepliesClicked:r}=(0,v._)(),l=(0,s.useCallback)((()=>{r(e),i?.()}),[e,r,i]);return(0,k.jsxs)(a.H,{condensedAll:!0,className:Y,size:"small",semanticColor:"textBase",onClick:l,children:[(0,k.jsx)(T.b,{className:q,images:n,shape:T.u.ROUNDED_CORNERS,size:O.Qe.SIZE_16,iconSize:"small",type:D.c.SHOW,title:""}),c.Ru.get("web-player.user-comments.collapsed-reply.count",t)]})},oe=e=>{const t=(0,s.useRef)(null);return(0,s.useEffect)((()=>{e&&t.current&&t.current.scrollIntoView({block:"start"})}),[e]),t};var ce=n(86869);const me=({comment:e,entityUri:t,lineClamp:n,scrollIntoViewOnMount:i})=>{const r=(0,s.useRef)(null),u=(0,ce.K)({ref:r}),d=oe(i),{uri:x,author:g,creationDate:p,text:h}=e,b=(0,k.jsx)(V,{author:g}),y=(0,k.jsx)(ne,{commentUri:e.uri,author:g}),j=(0,k.jsx)(Q,{creationDate:p}),v=(0,k.jsx)(le,{comment:e,entityUri:t}),C=(0,k.jsxs)("div",{className:A,children:[(0,k.jsx)(l.v,{ref:e=>{r.current=e?.querySelector("span")??null},semanticColor:"textBase",lineClamp:n,children:h}),u&&(0,k.jsx)(a.H,{semanticColor:"textBase",condensedAll:!0,size:"small",children:c.Ru.get("web-player.user-comments.see-more")})]});return(0,k.jsx)(m.h,{menu:(0,k.jsx)(B,{commentUri:e.uri,entityUri:t,author:e.author}),children:(0,k.jsx)(o.v,{ref:d,className:_,id:`comment-${x}`,size:"md",media:b,title:y,subtitle:j,trailing:v,layout:"wide",body:C,paddingInlineStart:"52px",paddingInlineEnd:"8px",paddingBlockStart:"8px",titleGap:"0",hoverAnimationDuration:"0ms",isInteractive:!0,children:e.text})})},ue=({comment:e,entityUri:t,showSeparator:n,lineClamp:i,onClickNavigate:u,scrollIntoViewOnMount:d,collapseReplies:x=!0})=>{const g=(0,s.useRef)(null),p=(0,ce.K)({ref:g}),h=oe(d),{uri:b,id:y,author:j,creationDate:v,text:C,imagesReacted:f,imagesReplied:w,replies:S,isPendingReview:R}=e,U=(0,s.useCallback)((()=>{u?.(y)}),[u,y]),E=u?U:void 0,N=(0,k.jsx)(V,{author:j}),I=(0,k.jsx)(ne,{commentUri:e.uri,author:j}),D=(0,k.jsx)(Q,{creationDate:v,isPendingReview:R}),T=(0,k.jsx)(le,{comment:e,entityUri:t,imagesReacted:f}),O=S&&S.length>0?S[0]:null;let F=null;O&&(F=x?(0,k.jsx)(ae,{commentUri:e.uri,numReplies:S.length,images:w,onClick:E}):(0,k.jsx)(me,{comment:O,entityUri:t,scrollIntoViewOnMount:d,lineClamp:i}));const L=(0,k.jsxs)("div",{className:A,children:[(0,k.jsx)(l.v,{ref:e=>{g.current=e?.querySelector("span")??null},semanticColor:"textBase",lineClamp:i,children:C}),p&&(0,k.jsx)(a.H,{semanticColor:"textBase",condensedAll:!0,size:"small",onClick:E,children:c.Ru.get("web-player.user-comments.see-more")})]});return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.h,{menu:(0,k.jsx)(B,{commentUri:e.uri,entityUri:t,author:e.author}),children:(0,k.jsx)(o.v,{ref:h,className:r()(_,{[W]:n}),id:`comment-${b}`,size:"md",media:N,title:I,subtitle:D,trailing:T,layout:"wide",body:L,paddingInlineStart:"8px",paddingInlineEnd:"8px",paddingBlockStart:"16px",paddingBlockEnd:"8px",titleGap:"0",onClick:E,hoverBackgroundColor:E?"backgroundElevatedHighlight":"backgroundHighlight",hoverAnimationDuration:"0ms",isInteractive:!0,children:e.text})}),F]})}},50974:(e,t,n)=>{n.d(t,{K:()=>l});var s=n(13505),i=n(8267),r=n(86070);const l=({eligibility:e})=>{const{message:t,isRestricted:n}=(0,i.K)(e);return n?(0,r.jsx)(s.E,{variant:"bodySmall",semanticColor:"textSubdued",children:t}):null}},33158:(e,t,n)=>{n.d(t,{CommentsList:()=>we});var s=n(30758),i=n(97500),r=n.n(i),l=n(60749),a=n(95079),o=n(59831),c=n(36419),m=n(94079);const u="HGjuMwWSWy3FYYnzyodc",d="QnZJ_bXjwXU8Z1ELdttH",x="SWm5_7dZbqBLpSa84ggz",g="V3Nj9Mnzlg09Xcdwk3TB",p="xROP0Ig23PJ2H5IU1c48",h="DXTPKhkIcqbD4TJYZep1",b="dF6Pl3ng7XHrYQ3m6WjC",y="o9Qze90DYZNMlWhHYnbI";var j=n(86070);const v=({children:e})=>{const t=(0,s.createRef)();return(0,j.jsx)(m.A,{in:!0,nodeRef:t,timeout:400,classNames:{enter:g,enterActive:p,exit:h,exitActive:b},children:(0,j.jsx)("div",{className:x,ref:t,children:(0,j.jsx)("div",{className:y,children:e})})})};var C=n(4413),f=n(13505),w=n(93492),S=n(84594),R=n(19837),k=n(50974),U=n(79133),E=n.n(U),N=n(61175),I=n(555),D=n(74905),B=n(42626);const T=({url:e,title:t})=>{const{openURLWithSessionTransfer:n}=(0,B.L)(),i=(0,s.useCallback)((()=>{n(e)}),[n,e]);return(0,j.jsx)(D.Y,{semanticColor:"textBase",onClick:i,children:t})},O=()=>(0,j.jsx)(T,{url:"https://www.spotify.com/safetyandprivacy/platform-rules",title:w.Ru.get("web-player.user-comments.trust-safety-modal.terms-conditions.platform-rules")});var _=n(30668),F=n(91354),A=n(50104),L=n(50154),P=n(61514);const z=()=>(0,j.jsx)(T,{url:"https://www.spotify.com/se/legal/end-user-agreement/",title:w.Ru.get("web-player.user-comments.trust-safety-modal.terms-conditions.terms-of-use")});var M=n(30320);const H="LTw1rQOh8jedxHmEmV5Y",K="FgLVUdYnnnDyo2qiCXUN",W="mXPudEv1VY8KNOdLMcqj",Y="CNxfpLOVnZR2mz_iBYro",q="kjwqPxVbTBKOEKtP8CR6",V=()=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",className:Y,children:(0,j.jsx)("path",{d:"M2.33333 15.9997C2.33333 8.45196 8.45228 2.33301 16 2.33301C23.5477 2.33301 29.6667 8.45196 29.6667 15.9997C29.6667 23.5474 23.5477 29.6663 16 29.6663C8.45228 29.6663 2.33333 23.5474 2.33333 15.9997Z",strokeWidth:"2"})}),Z=({value:e,title:t,subtitle:n})=>(0,j.jsx)(F.Sc,{className:W,value:e,isRequired:!0,children:({isSelected:e})=>(0,j.jsxs)(j.Fragment,{children:[e?(0,j.jsx)(M.k,{size:"large",semanticColor:"textBrightAccent"}):(0,j.jsx)(V,{}),(0,j.jsxs)("div",{className:q,children:[(0,j.jsx)(f.E,{variant:"bodyMediumBold",semanticColor:"textBase",children:t}),(0,j.jsx)(f.E,{variant:"bodySmall",semanticColor:"textBase",children:n})]})]})});var X=n(4586),Q=n(94119),G=n(92654),J=n(72288);const $=(0,Q.y)((()=>!1)),ee=e=>$.setState(e),te=()=>{const[e,t]=(0,J.x)("user-comments-approved-conditions",!1);return{isOpen:(0,G.Pj)($),setModalOpenState:ee,hasApproved:e,setHasApproved:t}},ne=()=>{const{isOpen:e,setModalOpenState:t,setHasApproved:n}=te(),{logCommentConsentAccepted:i}=(0,X._)(),[r,l]=(0,s.useState)(!1);return(0,j.jsx)(P.A,{isOpen:e,onRequestClose:()=>t(!1),children:(0,j.jsx)(_.l,{onInvalid:e=>{e.preventDefault(),l(!0)},onSubmit:e=>{e.preventDefault(),l(!1),i(),n(!0),t(!1)},children:(0,j.jsx)(F.$Q,{children:(0,j.jsxs)("div",{className:H,children:[(0,j.jsxs)("div",{className:K,children:[(0,j.jsx)(f.E,{variant:"titleSmall",semanticColor:"textBase",children:w.Ru.get("web-player.user-comments.trust-safety-modal.title")}),(0,j.jsx)(f.E,{variant:"bodySmall",children:w.Ru.get("web-player.user-comments.trust-safety-modal.subtitle")})]}),(0,j.jsxs)(L.a,{variant:"tinted",padding:"16px 24px",children:[(0,j.jsx)(Z,{title:w.Ru.get("web-player.user-comments.trust-safety-modal.row-1.title"),subtitle:w.Ru.get("web-player.user-comments.trust-safety-modal.row-1.subtitle"),value:"public"}),(0,j.jsx)(Z,{title:w.Ru.get("web-player.user-comments.trust-safety-modal.row-2.title"),subtitle:w.Ru.get("web-player.user-comments.trust-safety-modal.row-2.subtitle"),value:"review"}),(0,j.jsx)(Z,{title:w.Ru.get("web-player.user-comments.trust-safety-modal.row-3.title"),subtitle:w.Ru.get("web-player.user-comments.trust-safety-modal.row-3.subtitle"),value:"safety"})]}),(0,j.jsx)(f.E,{semanticColor:"textSubdued",variant:"bodySmall",children:w.Ru.get("web-player.user-comments.trust-safety-modal.terms-conditions",{platformRules:(0,j.jsx)(O,{}),termsOfUse:(0,j.jsx)(z,{})})}),(0,j.jsx)(A.b,{children:r&&(0,j.jsx)(f.E,{variant:"bodySmall",semanticColor:"textNegative",children:w.Ru.get("web-player.user-comments.trust-safety-modal.agree-to-continue")})}),(0,j.jsx)(I.$,{size:"large",type:"submit",children:w.Ru.get("web-player.user-comments.trust-safety-modal.submit")})]})})})})};var se=n(33016);const ie="EzubtLtLldmRrerGnzHG",re="WJoPBwb17TQkdjM85AjA",le="LIPKVT33tO8QKqsCDMiD",ae="Sts43e3FSkhLlkgWo3fC",oe=e=>e<=10?"textNegative":e<=20?"textWarning":"textSubdued",ce=({addComment:e,autoFocusInput:t})=>{const[n,i]=(0,s.useState)(""),r=(0,s.useRef)(null),{hasApproved:l,setModalOpenState:a}=te();(0,se.i)({ref:t?r:{current:null},preventScroll:!0,deps:[t]});const o=E()(n).length,c=500-o,m=c<0||0===o,u=(0,s.useCallback)((()=>{m||(e(n),i(""))}),[e,m,n]),d=(0,s.useCallback)((e=>{e.preventDefault(),u()}),[u]),x=(0,s.useCallback)((e=>{if(!l)return e.preventDefault(),void a(!0);"Enter"===e.key&&e.metaKey&&u()}),[l,a,u]),g=(0,s.useCallback)((e=>{e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`,i(e.target.value)}),[]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("form",{className:re,onSubmit:d,children:[(0,j.jsx)(N.h,{ref:r,className:ie,size:"small",placeholder:w.Ru.get("web-player.user-comments.comment-input.leave-comment"),onChange:g,onKeyDown:x}),(0,j.jsxs)("div",{className:le,children:[(0,j.jsx)(f.E,{semanticColor:"textSubdued",variant:"bodySmall",children:w.Ru.get("web-player.user-comments.comment-input.platform-rules",{platformRules:(0,j.jsx)(O,{})})}),(0,j.jsxs)("div",{className:ae,children:[(0,j.jsx)(f.E,{semanticColor:oe(c),variant:"bodySmall",children:c}),(0,j.jsx)(I.$,{type:"submit",size:"small","aria-disabled":m,children:w.Ru.get("web-player.user-comments.comment")})]})]})]}),(0,j.jsx)(ne,{})]})},me=({entityUri:e,comments:t,addComment:n,user:i,isRestricted:r})=>{const a=(0,s.useRef)(null),[o]=(0,l.ok)(),{logSubmitComment:c}=(0,X._)(),m="new"===o.get("id")||"top"===o.get("id"),u="new"===o.get("id");(0,s.useEffect)((()=>{m&&a.current&&a.current.scrollIntoView({block:"start"})}),[m]);const x=(0,s.useCallback)((t=>{c(e),n(t)}),[n,e,c]),g=0===t.totalCount;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f.E,{variant:"titleSmall",semanticColor:"textBase",ref:a,children:g?w.Ru.get("web-player.user-comments.comments"):w.Ru.get("web-player.user-comments.comment-list-header.count",t.totalCount)}),(0,j.jsxs)("div",{className:d,children:[(0,j.jsx)(k.K,{eligibility:t.eligibilityStatus}),!r&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(R.e,{label:i.displayName||i.username,width:32,images:i?.images,userIconSize:"small",testID:"user-widget-avatar"}),(0,j.jsx)(ce,{addComment:x,autoFocusInput:u})]})]}),!r&&g&&(0,j.jsx)(f.E,{variant:"bodySmall",semanticColor:"textSubdued",children:(0,S.v)("Be the first to leave a comment.")})]})};var ue=n(55158),de=n(12431),xe=n(69678);const ge="VOTkpOM9T_uWw08V0idk",pe="tT7fcnVhS31dtZnzuc99",he="m212OynDr3xEToeQapwg",be=({title:e,divider:t})=>(0,j.jsx)(de.v,{id:"sensitive-comments-section",media:(0,j.jsx)("div",{className:ge,children:(0,j.jsx)(xe.q,{size:"small",semanticColor:"textSubdued"})}),title:e,trailing:t&&(0,j.jsx)("div",{className:pe}),horizontalGap:"12px",paddingInlineStart:"0px"}),ye=({sensitiveComments:e,entityUri:t})=>{const[n,i]=(0,s.useState)(!1);return 0===e.length?null:n?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(be,{title:(0,j.jsx)(ue.d,{variant:"bodySmall",semanticColor:"textSubdued",children:(0,S.v)("Showing all comments")}),divider:n}),e.map(((e,n)=>(0,j.jsx)(v,{children:(0,j.jsx)(C.c,{comment:e,entityUri:t,showSeparator:n>0,collapseReplies:!1},e.id)},e.id)))]}):(0,j.jsx)(be,{title:(0,j.jsxs)(ue.d,{variant:"bodySmall",semanticColor:"textSubdued",children:[(0,S.v)("These comments may be inappropriate for some people. "),(0,j.jsx)(D.Y,{className:he,semanticColor:"textBase",onClick:()=>i(!0),children:(0,S.v)("Show all comments")})]}),divider:n})};var je=n(8267),ve=n(33659),Ce=n(91621);const fe=({commentsResponse:e,entityUri:t,user:n,className:i})=>{const{fetchNextPage:m,addComment:d}=(0,c.$)(t),[x]=(0,l.ok)(),g=(0,s.useMemo)((()=>e.comments.filter((e=>!e.isSensitive))),[e]),p=(0,s.useMemo)((()=>e.comments.filter((e=>e.isSensitive))),[e]),{isRestricted:h}=(0,je.K)(e.eligibilityStatus);return(0,j.jsxs)("div",{className:r()(u,i),style:{"--transition-duration":"400ms"},children:[(0,j.jsx)(me,{entityUri:t,comments:e,addComment:d,user:n,isRestricted:h}),(0,j.jsx)(o.B,{children:(0,j.jsx)(Ce._,{onReachBottom:m,children:(0,j.jsxs)(a.A,{component:null,children:[g.map(((e,n)=>(0,j.jsx)(v,{children:(0,j.jsx)(C.c,{comment:e,entityUri:t,showSeparator:n>0,scrollIntoViewOnMount:x.get("id")===e.id,collapseReplies:!1})},e.id))),(0,j.jsx)(ye,{sensitiveComments:p,entityUri:t})]})})})]})},we=({uri:e,className:t})=>{const{data:n}=(0,c.$)(e),s=(0,ve.C)();if(!n||!s)return null;const{isHidden:i}=(0,je.K)(n.eligibilityStatus);return i?null:(0,j.jsx)(fe,{commentsResponse:n,entityUri:e,user:s,className:t})}},53833:(e,t,n)=>{n.d(t,{DeleteCommentDialog:()=>m});var s=n(30758),i=n(62411),r=n(93492),l=n(45192),a=n(4586),o=n(50107),c=n(86070);const m=()=>{const e=(0,i.wA)(),{logCancelDeleteComment:t}=(0,a._)(),{isOpen:n,onConfirm:m}=(0,i.d4)((e=>e.ui.deleteCommentDialog)),u=(0,s.useCallback)((()=>{t(),e(o.FR.actions.close())}),[e,t]),d=(0,s.useCallback)((()=>{m(),e(o.FR.actions.close())}),[e,m]);return(0,c.jsx)(l.T,{isOpen:n,"aria-label":r.Ru.get("web-player.user-comments.delete-comment-dialog.title"),titleText:r.Ru.get("web-player.user-comments.delete-comment-dialog.title"),descriptionText:r.Ru.get("web-player.user-comments.delete-comment-dialog.subtitle"),onConfirm:d,onClose:u,confirmText:r.Ru.get("contextmenu.delete"),confirmLabel:r.Ru.get("contextmenu.delete"),cancelText:r.Ru.get("queue.cancel-button")})}},26071:(e,t,n)=>{n.d(t,{TopCommentsCard:()=>S});var s=n(30758),i=n(85387),r=n(60749),l=n(61e3),a=n(21974),o=n(72574),c=n(93492),m=n(80435),u=n(814),d=n(46710),x=n(55037),g=n(58897);var p=n(50974),h=n(4413),b=n(8267);const y="jmVy04VnzhcDZbU5PDSR",j="dkV2Y3wOToyBbzjsYFDE",v="Art4GUNuIb1DIs1FlRRq",C="cTMTF6fQBMbj8gVHfp5t",f="WWXdDi6SRZBkgybtn0aT";var w=n(86070);const S=({uri:e})=>{const{data:t}=(e=>{const t=(0,g.n)(),{data:n,isLoading:s,isError:i}=(0,d.I)({queryKey:x.K.topComments(e),queryFn:async()=>await t.getTopComments(e),gcTime:36e5,staleTime:3e4});return{data:n,isLoading:s,isError:i}})(e),n=(0,i.Zp)(),S=(0,s.useCallback)((t=>{const s=(0,o.o_h)(e)?.toURLPath(!0);s&&n({pathname:s,search:(0,r.PI)({id:t}).toString()})}),[n,e]);if(!t||0===t.totalCount)return null;const{isRestricted:R,isHidden:k}=(0,b.K)(t.eligibilityStatus);if(k)return null;const U=t.comments.length>0;return(0,w.jsxs)(u.w,{className:y,children:[(0,w.jsx)(u.X,{className:j,action:(0,w.jsx)(l.H,{size:"small",condensed:!0,semanticColor:"textSubdued",onClick:()=>S("top"),children:c.Ru.get("web-player.user-comments.top-comment-card-header.count",t.totalCount)}),children:c.Ru.get("web-player.user-comments.comments")}),U&&(0,w.jsx)(m.a,{className:C,children:(0,w.jsx)("div",{className:f,children:t.comments.map(((t,n)=>(0,w.jsx)(h.c,{comment:t,entityUri:e,showSeparator:n>0,lineClamp:2,onClickNavigate:S},`${t.uri}-${n}`)))})}),(0,w.jsx)("div",{className:v,children:R?(0,w.jsx)(p.K,{eligibility:t.eligibilityStatus}):(0,w.jsx)(a.n,{size:"small",onClick:()=>S("new"),children:c.Ru.get("web-player.user-comments.comment-input.leave-comment")})})]})}},306:(e,t,n)=>{n.d(t,{Y:()=>o});var s=n(30758),i=n(72574),r=n(12469),l=n(37395),a=n(9043);const o=e=>{const t=(0,l.f)(),[n,o]=(0,s.useState)(!1);if(!(0,i.APS)(e))throw new Error(`Expected a Spotify uri in format 'spotify:user:***', got "${e}"`);const c=(0,s.useCallback)((s=>s&&!n?t.followUsers([e]):!s&&n?t.unfollowUsers([e]):Promise.resolve()),[t,n,e]);return(0,s.useEffect)((()=>{o(!1),t.isFollowing([e]).then((t=>{o(t[e]??!1)}))}),[t,e]),(0,a.N)(r.mc.OPERATION_COMPLETE,(t=>{t.data.uris.includes(e)&&!t.data.error&&(t.data.operation===r.JK.FOLLOW_USER?o(!0):t.data.operation===r.JK.UNFOLLOW_USER&&o(!1))})),[n,c]}},91621:(e,t,n)=>{n.d(t,{_:()=>m});var s=n(30758),i=n(75773),r=n(97500),l=n.n(r);const a="eqw9lvuoZHrkWMTdyTpY",o="lb08f71wES9AQnKx6e0R";var c=n(86070);const m=(0,s.memo)((function(e){const{triggerOnInitialLoad:t=!1,onReachBottom:n,showScrollbar:r=!0,horizontalScroll:m=!1,className:u}=e,{ref:d,inView:x}=(0,i.Wx)({initialInView:t});return(0,s.useLayoutEffect)((()=>{x&&n&&n()}),[x,n]),(0,c.jsxs)("div",{className:l()({[o]:!r,[a]:m},u),"data-testid":"infinite-scroll-list",children:[e.children,(0,c.jsx)("div",{ref:d})]})}))},84594:(e,t,n)=>{function s(e){return e}n.d(t,{v:()=>s})},814:(e,t,n)=>{n.d(t,{X:()=>s.X,w:()=>s.w});var s=n(90636)},55037:(e,t,n)=>{n.d(t,{K:()=>s});const s={all:["user-comments"],byEntity:e=>[...s.all,e],topComments:e=>[...s.byEntity(e),"top"],allComments:e=>[...s.byEntity(e),"all"]}},36419:(e,t,n)=>{n.d(t,{$:()=>c});var s=n(30758),i=n(98929),r=n(12265),l=n(46581),a=n(55037),o=n(58897);const c=e=>{const t=(0,o.n)(),n=(0,i.jE)(),{data:c,isLoading:m,isError:u,fetchNextPage:d}=(0,r.q)({queryKey:a.K.allComments(e),queryFn:({pageParam:n})=>t.getComments(e,n),initialPageParam:void 0,getNextPageParam:e=>e.nextPageToken,gcTime:36e5,staleTime:3e4}),x=(0,s.useCallback)((()=>{n.invalidateQueries({queryKey:a.K.byEntity(e)})}),[n,e]),{mutate:g,isPending:p}=(0,l.n)({mutationFn:n=>t.addComment(e,n),onSettled:()=>{x()}});return{data:(0,s.useMemo)((()=>c&&0!==c.pages.length?{comments:c.pages.flatMap((e=>e.comments)),eligibilityStatus:c.pages[0].eligibilityStatus,totalCount:c.pages[0].totalCount,nextPageToken:null}:null),[c]),fetchNextPage:d,addComment:g,isPendingComment:p,isLoading:m,isError:u,refreshComments:x}}},58897:(e,t,n)=>{n.d(t,{n:()=>r});var s=n(35988),i=n(18308);const r=()=>(0,i.N)(s.v)},4586:(e,t,n)=>{n.d(t,{_:()=>a});var s=n(30758),i=n(30918),r=n(72574),l=n(82362);const a=()=>{const{spec:e,logger:t}=(0,l.r)(i.U,{});return{logCommentConsentAccepted:(0,s.useCallback)((()=>{const n=e.commentConsentFormFactory().acceptButtonFactory().hitUiReveal();t.logInteraction(n)}),[t,e]),logSubmitComment:(0,s.useCallback)((n=>{const s=e.commentInputFieldFactory().submitButtonFactory().hitSubmitComment({entityId:n});t.logInteraction(s)}),[t,e]),logNavigateToCommentAuthor:(0,s.useCallback)(((n,s)=>{const i=(0,r.o_h)(s).toURLPath(!0),l=e.commentListFactory().commentRowFactory({uri:n}).commentAuthorLinkFactory().hitUiNavigate({destination:i});t.logInteraction(l)}),[t,e]),logSeeRepliesClicked:(0,s.useCallback)((n=>{const s=e.commentListFactory().commentRowFactory({uri:n}).seeRepliesLinkFactory().hitUiNavigate({destination:n});t.logInteraction(s)}),[t,e]),logCommentMenuOpened:(0,s.useCallback)((n=>{const s=e.commentListFactory().commentRowFactory({uri:n}).contextMenuButtonFactory().hitUiReveal();t.logInteraction(s)}),[t,e]),logDeleteComment:(0,s.useCallback)((n=>{const s=e.deleteCommentDialogFactory().confirmDeleteButtonFactory().hitDeleteComment({commentId:n});t.logInteraction(s)}),[t,e]),logCancelDeleteComment:(0,s.useCallback)((()=>{const n=e.deleteCommentDialogFactory().cancelButtonFactory().hitUiHide();t.logInteraction(n)}),[t,e])}}},8267:(e,t,n)=>{n.d(t,{K:()=>r});var s=n(93492),i=n(12667);const r=e=>{let t=null,n=!1;switch(e){case i.S.ELIGIBILITY_STATUS_DISABLED:t=s.Ru.get("web-player.user-comments.commenting-restrictions.disabled");break;case i.S.ELIGIBILITY_STATUS_NEW_USER_ACCOUNT:t=s.Ru.get("web-player.user-comments.commenting-restrictions.new-user-account");break;case i.S.ELIGIBILITY_STATUS_ALREADY_COMMENTED:t=s.Ru.get("web-player.user-comments.commenting-restrictions.already-commented");break;case i.S.ELIGIBILITY_STATUS_HIDDEN:n=!0}return{message:t,isRestricted:null!==t,isHidden:n}}},33659:(e,t,n)=>{n.d(t,{C:()=>r});var s=n(62411),i=n(78172);const r=()=>{const e=(0,s.d4)((e=>e.session?.user));return e?{type:i.c.USER,uri:e.uri,username:e.id,displayName:e.display_name??null,images:e.images.map((({url:e,width:t,height:n})=>({url:e,width:t||void 0,height:n||void 0})))}:null}},37395:(e,t,n)=>{n.d(t,{f:()=>r});var s=n(68334),i=n(18308);const r=()=>(0,i.N)(s.t)},9043:(e,t,n)=>{n.d(t,{N:()=>r});var s=n(30758),i=n(37395);const r=(e,t)=>{const n=(0,i.f)();(0,s.useEffect)((()=>n.getEvents().addListener(e,t)),[e,n,t])}},33887:(e,t,n)=>{n.d(t,{Bj:()=>i,T4:()=>r,kt:()=>l});var s=n(72574);function i(e,t){if(!t)return null;const n=(0,s.o_h)(t);if(!n||!(0,s.APS)(n))return null;const i=(0,s.XIp)(n.username);return e.find((e=>e.username===i))??null}function r(e){const t=e.getCurrentSession(),n=t?.sessionOwnerId;return n?t.sessionMembers.find((e=>e.id===n))??null:null}function l(e,t){if(!t||!function(e){return e.getCurrentSession()?.isSessionOwner??!1}(e))return!1;const n=e.getCurrentSession(),s=i(n?.sessionMembers??[],t),l=r(e);return!!s&&s?.username!==l?.username}}}]);
//# sourceMappingURL=dwp-user-comments.js.map