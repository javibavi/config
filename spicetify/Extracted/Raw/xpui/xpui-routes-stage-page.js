"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[5523],{17940:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ie});var i=a(30758),r=a(85387),s=a(40904),n=a(3118),o=a(93492),l=a(38167),c=a(8030),d=a(60376);var u=a(86697),h=a(48855),g=a(42451),I=a.n(g);let S=null;const E=(0,a(61329).h)();function T(e){const t=(0,u.S)((e=>e.setStatus)),[a,r]=(0,i.useState)(""),s=(0,i.useCallback)((async()=>{if(e){t(h.Z.AUTHENTICATION_STARTED);const a=await p(e).catch((e=>{throw(S||(S=g.logger),S).error("error: could not fetch IDT token!"),t(h.Z.AUTHENTICATION_FAILED),e}));a&&(t(h.Z.AUTHENTICATION_SUCCEEDED),r(a.accessToken))}}),[e,t]);return(0,i.useEffect)((()=>{e&&s()}),[e,s]),a}async function p(e){if(!e)return;const t=new URL("sp://auth/v1/token_web_auth");return t.searchParams.append("audience",e),await E.get(t.toString())}var f=a(72574),N=a(71338);var b=a(62411);var m=a(93885);function C(e,t){const a=(0,i.useRef)(),s=function(){const e=(0,i.useRef)(),t=(0,u.S)((e=>e.setStatus)),a=(0,i.useCallback)((()=>{t(h.Z.PAGE_LOAD_STARTED),e.current=setTimeout((()=>{I().error("[The Stage] Message handshake timeout (5s)"),t(h.Z.PAGE_LOAD_FAILED)}),5e3)}),[t]),r=(0,i.useCallback)((()=>{clearTimeout(e.current)}),[]),s=(0,i.useCallback)((()=>{t(h.Z.PAGE_LOAD_SUCCEEDED),r()}),[t,r]);return(0,i.useMemo)((()=>({handleStarted:a,handleClear:r,handleCompleted:s})),[r,s,a])}(),n=function(){const e=(0,r.Zp)(),t=(0,b.d4)((e=>e.ui.history.canGoBack));return(0,i.useCallback)((()=>{e(t?-1:"/")}),[e,t])}(),l=(()=>{const e=(0,u.S)((e=>e.setStatus)),{enqueueSnackbar:t}=(0,N.d)(),a=(0,i.useCallback)((()=>{t(o.Ru.get("feedback.link-copied")),e(h.Z.SHARE_EVENT)}),[t,e]),r=(0,i.useCallback)((a=>{t(o.Ru.get("error.generic")),e(h.Z.ERROR)}),[t,e]);return(0,i.useMemo)((()=>({onSuccess:a,onError:r})),[a,r])})(),c=(0,i.useCallback)((i=>{if(!e.includes(i.origin))return;const r=JSON.parse(i.data);"didRequestInitialize"===r.type?(a.current={source:i.source,options:{targetOrigin:i.origin}},function(e){const{source:t,options:a}=e,i=JSON.stringify({type:"ready",capabilities:{}});t.postMessage(i,a)}(a.current),s.handleCompleted()):"didRequestIDToken"===r.type?(a.current={source:i.source,options:{targetOrigin:i.origin}},async function(e,t){const{source:a,options:i}=e,r=await p(t);if(!r)return;if(!r.accessToken)return;const s=JSON.stringify({type:"didReceiveIDToken",token:r.accessToken});a.postMessage(s,i)}(a.current,t)):"didRequestClose"===r.type?n():"didRequestShare"===r.type&&async function(e,t,a){const{source:i,options:r}=e;if("didRequestShare"!==t.type)return;let s;const n=(0,f.o_h)(t.url);n&&(s=n.toURL());await(0,m.l)(s).catch((e=>{throw a.onError(e),e})),a.onSuccess();const o={type:"didDismissShare",requestId:t.requestId};i.postMessage(JSON.stringify(o),r)}(a.current,r,l)}),[e,t,s,n,l]);(0,i.useEffect)((()=>(window.addEventListener("message",c),s.handleStarted(),()=>{window.removeEventListener("message",c),s.handleClear()})),[c,s])}var y=a(46710),k=a(68813);let w=function(e){return e[e.NONE=0]="NONE",e[e.STT=1]="STT",e[e.IDT=2]="IDT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function O(e){switch(e){case 0:case"NONE":return w.NONE;case 1:case"STT":return w.STT;case 2:case"IDT":return w.IDT;default:return w.UNRECOGNIZED}}let v=function(e){return e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.ACTIVE=2]="ACTIVE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function D(e){switch(e){case 0:case"INVALID":return v.INVALID;case 1:case"VALID":return v.VALID;case 2:case"ACTIVE":return v.ACTIVE;default:return v.UNRECOGNIZED}}let L=function(e){return e[e.ALCOHOL=0]="ALCOHOL",e[e.ENERGY_DRINKS=1]="ENERGY_DRINKS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});const A={fromJSON:e=>({id:P(e.id)?globalThis.String(e.id):"0",campaignId:P(e.campaignId)?globalThis.String(e.campaignId):"0",lookupToken:P(e.lookupToken)?globalThis.String(e.lookupToken):"",url:P(e.url)?globalThis.String(e.url):"",authType:P(e.authType)?O(e.authType):0,clientId:P(e.clientId)?globalThis.String(e.clientId):void 0,hasAudio:!!P(e.hasAudio)&&globalThis.Boolean(e.hasAudio),status:P(e.status)?D(e.status):0,restricted:!!P(e.restricted)&&globalThis.Boolean(e.restricted),gcpProjectId:P(e.gcpProjectId)?globalThis.String(e.gcpProjectId):"",defaultLocale:P(e.defaultLocale)?globalThis.String(e.defaultLocale):"",restrictions:globalThis.Array.isArray(e?.restrictions)?e.restrictions.map((e=>function(e){switch(e){case 0:case"ALCOHOL":return L.ALCOHOL;case 1:case"ENERGY_DRINKS":return L.ENERGY_DRINKS;default:return L.UNRECOGNIZED}}(e))):[],enableLegacySharing:!!P(e.enableLegacySharing)&&globalThis.Boolean(e.enableLegacySharing),hidePlayer:!!P(e.hidePlayer)&&globalThis.Boolean(e.hidePlayer),legacyBackBehavior:!!P(e.legacyBackBehavior)&&globalThis.Boolean(e.legacyBackBehavior),enableCheckout:!!P(e.enableCheckout)&&globalThis.Boolean(e.enableCheckout),allowedCountries:globalThis.Array.isArray(e?.allowedCountries)?e.allowedCountries.map((e=>globalThis.String(e))):[],restoreOnKilled:!!P(e.restoreOnKilled)&&globalThis.Boolean(e.restoreOnKilled),enableMediaDevices:!!P(e.enableMediaDevices)&&globalThis.Boolean(e.enableMediaDevices)}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.campaignId&&(t.campaignId=e.campaignId),""!==e.lookupToken&&(t.lookupToken=e.lookupToken),""!==e.url&&(t.url=e.url),0!==e.authType&&(t.authType=function(e){switch(e){case w.NONE:return"NONE";case w.STT:return"STT";case w.IDT:return"IDT";case w.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.authType)),void 0!==e.clientId&&(t.clientId=e.clientId),!1!==e.hasAudio&&(t.hasAudio=e.hasAudio),0!==e.status&&(t.status=function(e){switch(e){case v.INVALID:return"INVALID";case v.VALID:return"VALID";case v.ACTIVE:return"ACTIVE";case v.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.status)),!1!==e.restricted&&(t.restricted=e.restricted),""!==e.gcpProjectId&&(t.gcpProjectId=e.gcpProjectId),""!==e.defaultLocale&&(t.defaultLocale=e.defaultLocale),e.restrictions?.length&&(t.restrictions=e.restrictions.map((e=>function(e){switch(e){case L.ALCOHOL:return"ALCOHOL";case L.ENERGY_DRINKS:return"ENERGY_DRINKS";case L.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e)))),!1!==e.enableLegacySharing&&(t.enableLegacySharing=e.enableLegacySharing),!1!==e.hidePlayer&&(t.hidePlayer=e.hidePlayer),!1!==e.legacyBackBehavior&&(t.legacyBackBehavior=e.legacyBackBehavior),!1!==e.enableCheckout&&(t.enableCheckout=e.enableCheckout),e.allowedCountries?.length&&(t.allowedCountries=e.allowedCountries),!1!==e.restoreOnKilled&&(t.restoreOnKilled=e.restoreOnKilled),!1!==e.enableMediaDevices&&(t.enableMediaDevices=e.enableMediaDevices),t},create:e=>A.fromPartial(e??{}),fromPartial(e){const t={id:"0",campaignId:"0",lookupToken:"",url:"",authType:0,clientId:void 0,hasAudio:!1,status:0,restricted:!1,gcpProjectId:"",defaultLocale:"",restrictions:[],enableLegacySharing:!1,hidePlayer:!1,legacyBackBehavior:!1,enableCheckout:!1,allowedCountries:[],restoreOnKilled:!1,enableMediaDevices:!1};return t.id=e.id??"0",t.campaignId=e.campaignId??"0",t.lookupToken=e.lookupToken??"",t.url=e.url??"",t.authType=e.authType??0,t.clientId=e.clientId??void 0,t.hasAudio=e.hasAudio??!1,t.status=e.status??0,t.restricted=e.restricted??!1,t.gcpProjectId=e.gcpProjectId??"",t.defaultLocale=e.defaultLocale??"",t.restrictions=e.restrictions?.map((e=>e))||[],t.enableLegacySharing=e.enableLegacySharing??!1,t.hidePlayer=e.hidePlayer??!1,t.legacyBackBehavior=e.legacyBackBehavior??!1,t.enableCheckout=e.enableCheckout??!1,t.allowedCountries=e.allowedCountries?.map((e=>e))||[],t.restoreOnKilled=e.restoreOnKilled??!1,t.enableMediaDevices=e.enableMediaDevices??!1,t}};const R={fromJSON:e=>({site:P(e.site)?A.fromJSON(e.site):void 0}),toJSON(e){const t={};return void 0!==e.site&&(t.site=A.toJSON(e.site)),t},create:e=>R.fromPartial(e??{}),fromPartial(e){const t={site:void 0};return t.site=void 0!==e.site&&null!==e.site?A.fromPartial(e.site):void 0,t}};function P(e){return null!=e}var U=a(44816);const _={fromJSON:e=>({id:G(e.id)?globalThis.String(e.id):"0",siteId:G(e.siteId)?globalThis.String(e.siteId):"0",title:G(e.title)?globalThis.String(e.title):"",description:G(e.description)?globalThis.String(e.description):"",previewImageUrl:G(e.previewImageUrl)?globalThis.String(e.previewImageUrl):"",locale:G(e.locale)?globalThis.String(e.locale):"",height:G(e.height)?globalThis.Number(e.height):void 0,width:G(e.width)?globalThis.Number(e.width):void 0}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.siteId&&(t.siteId=e.siteId),""!==e.title&&(t.title=e.title),""!==e.description&&(t.description=e.description),""!==e.previewImageUrl&&(t.previewImageUrl=e.previewImageUrl),""!==e.locale&&(t.locale=e.locale),void 0!==e.height&&(t.height=Math.round(e.height)),void 0!==e.width&&(t.width=Math.round(e.width)),t},create:e=>_.fromPartial(e??{}),fromPartial(e){const t={id:"0",siteId:"0",title:"",description:"",previewImageUrl:"",locale:"",height:void 0,width:void 0};return t.id=e.id??"0",t.siteId=e.siteId??"0",t.title=e.title??"",t.description=e.description??"",t.previewImageUrl=e.previewImageUrl??"",t.locale=e.locale??"",t.height=e.height??void 0,t.width=e.width??void 0,t}};const M={fromJSON:e=>({metadata:G(e.metadata)?_.fromJSON(e.metadata):void 0}),toJSON(e){const t={};return void 0!==e.metadata&&(t.metadata=_.toJSON(e.metadata)),t},create:e=>M.fromPartial(e??{}),fromPartial(e){const t={metadata:void 0};return t.metadata=void 0!==e.metadata&&null!==e.metadata?_.fromPartial(e.metadata):void 0,t}};function G(e){return null!=e}var Z=a(49593);const B=18e5,V=6e5,J={all:["vtec"],sites:()=>[...J.all,"site"],site:e=>[...J.sites(),e],siteMetadata:(e,t)=>[...J.site(e),t]},K=e=>{const{onStart:t,onError:a,onSuccess:i}=(()=>{const e=(0,u.S)((e=>e.setStatus));return{onStart:()=>e(h.Z.RESOLVING_SITE_STARTED),onSuccess:()=>e(h.Z.RESOLVING_SITE_SUCCEEDED),onError:t=>{e(h.Z.RESOLVING_SITE_FAILED)}}})(),{data:r,error:s,isPending:n,isSuccess:l}=(0,y.I)({queryKey:J.site(e),queryFn:async()=>(t(),await(async(e,t)=>await e.build().withHost(`${U.sp}`).withMethod("GET").withoutMarket().withPath(`/site/${t}`).withEndpointIdentifier("/site/{lookupId}").withJsonContentType().send().then((e=>({...e,body:R.fromJSON(e.body)}))))(Z.n.getInstance(),e)),select:e=>e.body.site,staleTime:V,gcTime:B});if(s)throw a(s),s;const c=o.Ru.getLocaleForTranslation(),{data:d,error:g,isPending:I,isSuccess:S}=(0,y.I)({queryKey:J.siteMetadata(e,c),queryFn:r?.defaultLocale?async()=>{const t=await(async(e,t,a)=>await e.build().withHost(`${U.sp}`).withMethod("GET").withoutMarket().withPath(`/sites/${t}/metadata/${a}`).withEndpointIdentifier("/sites/{lookupId}/metadata/{localeCode}").withJsonContentType().send().then((e=>({...e,body:M.fromJSON(e.body)}))))(Z.n.getInstance(),e,c);return i(),t}:k.hT,select:e=>e.body.metadata,enabled:!!r?.defaultLocale,staleTime:V,gcTime:B});if(g)throw a(g),g;return{site:r,isSiteSuccess:l,siteMetadata:d,isSiteMetadataSuccess:S,isPending:n||I}},j="NWSmcn03uY8Fosh_mYCi",q="N9ngMcd9oSDEd8zK5jBj",H="kYOJhuJ996EIMXFJD3By";var x=a(86070);const Y=()=>{const{lookupToken:e=""}=(0,r.g)(),{site:t,siteMetadata:a}=K(e);if(!t||!a)throw new Error(`[The Stage]: Missing data for site: ${e}`);C(t.url,t.clientId);const i=T(t.clientId),s=(()=>{const e=(0,d.k)();if(!e)return;const{containerVersion:t}=e;return t.substring(0,t.lastIndexOf("."))})();let n="";return t.url&&s&&(n=function(e,t,a){const i=new URL(e);i.searchParams.append("utm_app_version",t),a&&(i.hash=`#id_token=${a}`);return i.toString()}(t.url,s,i)),(0,x.jsx)("div",{className:j,children:(0,x.jsx)("iframe",{title:a.title,name:"stage-view-frame",id:q,src:n,sandbox:"allow-scripts allow-same-origin"})})};var F=a(97500),$=a.n(F),z=a(42372);var W=a(59857),X=a(14109),Q=a(75097);const ee=X.$S.PANEL_CLOSE_CLICK;var te=a(64273);var ae=a(90630);const ie=e=>{(()=>{const{scrollNodeChildRef:e}=(0,i.useContext)(z.bi);(0,i.useEffect)((()=>{const t=e?.current,a=e?.current?.className;return t&&(t.className=$()(a,H)),()=>{t&&(t.className=$()(a))}}),[e])})(),(()=>{const{isActive:e,panelSend:t}=(0,W.AI)(Q.Z.NowPlayingView);e&&t(ee)})(),function(){const e=(0,te.z)();e.getState()?.hasContext&&!e.getState()?.isPaused&&e.pause()}();const{lookupToken:t=""}=(0,r.g)(),{isPending:a}=K(t),[d]=(0,i.useState)((0,s.A)());((e,t)=>{const a=(0,u.S)((e=>e.setStatus)),r=(0,u.S)((e=>e.setSession)),s=(0,u.S)((e=>e.resetSession)),n=(0,i.useCallback)(a,[a]),o=(0,i.useCallback)(r,[r]),l=(0,i.useCallback)(s,[s]);(0,i.useEffect)((()=>(o({siteId:e,sessionId:t,startTime:Date.now()}),n(h.Z.PRESENTED),()=>{n(h.Z.DISMISSED),l()})),[l,o,n,t,e])})(t,d);return(0,n.NC)(ae.n2U)?(0,x.jsx)(l.s,{children:a?(0,x.jsx)(c.LoadingPage,{hasError:!1,errorMessage:o.Ru.get("error.generic")}):(0,x.jsx)(Y,{})}):(0,x.jsx)(c.LoadingPage,{hasError:!0,errorMessage:o.Ru.get("error.not_found.title.page")})}},60376:(e,t,a)=>{a.d(t,{k:()=>s});var i=a(30758),r=a(70603);function s(){const e=(0,r.t)(),[t,a]=(0,i.useState)(null);return(0,i.useEffect)((()=>{let t=!0;return e.getVersionInfo().then((e=>{t&&a(e)})),()=>{t=!1}}),[e,a]),t}}}]);
//# sourceMappingURL=xpui-routes-stage-page.js.map